<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detect patches (clumps) of cells — patches • terra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Detect patches (clumps) of cells — patches"><meta property="og:description" content="Detect patches (clumps). Patches are groups of cells that are surrounded by cells that are NA. Set zeroAsNA to TRUE to also identify patches separated by cells with values of zero."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">terra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5-40</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rspatial/terra/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detect patches (clumps) of cells</h1>
    
    <div class="hidden name"><code>patches.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Detect patches (clumps). Patches are groups of cells that are surrounded by cells that are <code>NA</code>. Set <code>zeroAsNA</code> to <code>TRUE</code> to also identify patches separated by cells with values of zero.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S4 method for SpatRaster</span>
<span class="fu">patches</span><span class="op">(</span><span class="va">x</span>, directions<span class="op">=</span><span class="fl">4</span>, zeroAsNA<span class="op">=</span><span class="cn">FALSE</span>, allowGaps<span class="op">=</span><span class="cn">TRUE</span>, filename<span class="op">=</span><span class="st">""</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>SpatRaster</p></dd>
<dt>directions</dt>
<dd><p>integer indicating which cells are considered adjacent. Should be 8 (Queen's case) or 4 (Rook's case)</p></dd>
<dt>zeroAsNA</dt>
<dd><p>logical. If <code>TRUE</code> treat cells that are zero as if they were <code>NA</code></p></dd>
<dt>allowGaps</dt>
<dd><p>logical. If <code>TRUE</code> there may be gaps in the patch IDs (e.g. you may have patch IDs 1, 2, 3 and 5, but not 4). If it is FALSE, these numbers will be recoded from 1 to the number of patches (4 in this example)</p></dd>
<dt>filename</dt>
<dd><p>character. Output filename</p></dd>
<dt>...</dt>
<dd><p>options for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>SpatRaster. Cell values are patch numbers</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="focal.html">focal</a></code>, <code><a href="boundaries.html">boundaries</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">18</span>, ncols<span class="op">=</span><span class="fl">36</span>, xmin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">22</span><span class="op">:</span><span class="fl">36</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">:</span><span class="fl">29</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># zero as background instead of NA</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">10</span>, ncols<span class="op">=</span><span class="fl">10</span>, xmin<span class="op">=</span><span class="fl">0</span>, vals<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span class="r-in"><span class="va">r</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># treat zeros as NA</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, <span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">### patches for different values</span></span>
<span class="r-in"><span class="co"># remove zeros manually</span></span>
<span class="r-in"><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="classify.html">classify</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># make layers for each value</span></span>
<span class="r-in"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="segregate.html">segregate</a></span><span class="op">(</span><span class="va">rr</span>, keep<span class="op">=</span><span class="cn">TRUE</span>, other<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">### patch ID values are not guaranteed to be consecutive</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">5</span>, ncols<span class="op">=</span><span class="fl">10</span>, xmin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="values.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="dimensions.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.7</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, directions<span class="op">=</span><span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span class="r-in"><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">rp</span>, type<span class="op">=</span><span class="st">"classes"</span><span class="op">)</span>; <span class="fu"><a href="text.html">text</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span>
<span class="r-plt img"><img src="patches-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## unless you set allowGaps=FALSE</span></span>
<span class="r-in"><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, directions<span class="op">=</span><span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span>, allowGaps<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span>
<span class="r-in"><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">rp</span>, type<span class="op">=</span><span class="st">"classes"</span><span class="op">)</span>; <span class="fu"><a href="text.html">text</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span>
<span class="r-plt img"><img src="patches-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">### use zonal to remove small patches </span></span>
<span class="r-in"><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="classify.html">classify</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">400</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># remove patches smaller than 100 ha</span></span>
<span class="r-in"><span class="va">rz</span> <span class="op">&lt;-</span> <span class="fu"><a href="zonal.html">zonal</a></span><span class="op">(</span><span class="fu"><a href="cellSize.html">cellSize</a></span><span class="op">(</span><span class="va">y</span>, unit<span class="op">=</span><span class="st">"ha"</span><span class="op">)</span>, <span class="va">y</span>, <span class="va">sum</span>, as.raster<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="ifelse.html">ifel</a></span><span class="op">(</span><span class="va">rz</span> <span class="op">&lt;</span> <span class="fl">100</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

